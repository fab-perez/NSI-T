# Protocoles de routage

##	Couche Internet et adresses IP

###	Les modèles OSI et TCP/IP

Communiquer consiste à transmettre des informations, mais tant que les interlocuteurs ne lui ont pas attribué un sens, il ne s'agit que de données et pas d'information. Les interlocuteurs doivent donc non seulement parler un langage commun mais aussi maîtriser des règles minimales d'émission et de réception des données. C'est le rôle d'un protocole.

!!! abstract "Cours" 
    L'ensemble des règles qui permettent à 2 ordinateurs de communiquer ensemble via un réseau s'appelle un **protocole**.

Afin de s'y retrouver au milieu des protocoles réseaux, les modèles OSI et TCP/IP permettent de les classer selon leurs niveaux d'abstractions, dans ce qu'on appelle des couches. 

!!! abstract "Cours" 
    La définition d'une **couche réseau** est assez abstraite, mais on peut dire qu'il s'agit d'un ensemble de protocoles, qui sont au même niveau d'abstraction, qui ont des fonctions similaires.

Le modèle OSI (de l'anglais Open Systems Interconnection) comporte sept couches. Le modèle TCP/IP est plus simple, il ne comporte que quatre couches : Accès au Réseau, Internet, Transport et Application.


![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-light-mode.png#only-light)
![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-dark-mode.png#only-dark)



###	La couche Accès au Réseau : les adresses MAC

![Une carte réseau Ethernet](assets/4-carte-interface-reseau.png){width="20%" align=right}


Une carte d'interface réseau -- appelée aussi carte réseau ou NIC (pour *Network Interface Controller*) -- par exemple une carte Ethernet ou WiFi, possède une adresse unique, appelée **adresse MAC** (*Media Access Control*) qui est donnée par le constructeur de la carte et qui permet de l'identifier de façon unique.

![Adresse MAC d'une machine dans un réseau Filius](assets/4-adresse-mac-machine-filius.png){width="20%" align=left}

L'adresse MAC est constituée de 6 octets écrits sous forme hexadécimale, chacun séparé par " : " (par exemple : `00:13:A9:58:32:EB`). Les 3 premiers octets définissent le constructeur de la carte réseau (ici Sony Corporation), les 3 derniers le numéro de fabrication.




Dans un réseau, un commutateur (ou *switch*) connaît les adresses MAC des machines qui lui sont branchées. 

Les paquets envoyées à l'adresse MAC `FF:FF:FF:FF:FF:FF` (adresse *broadcast*) sont envoyés à toutes les machines connectées au réseau. Le protocole ARP (*Address Resolution Protocol*) permet de lier les adresses MAC aux adresses IP correspondantes.

###	La couche Internet : les adresses IP

!!! abstract "Cours" 
    L'adresse IP permet à deux machines de communiquer entre elles sur un réseau. Une machine peut avoir plusieurs IP, chaque IP étant associée à une carte d'interface réseau.

Il existe des adresses IP de version 4 sur 32 bits (IPv4), et de version 6 sur 128 bits (IPv6). 

-    La version IPv4 est actuellement la plus utilisée : elle est généralement représentée en notation décimale avec quatre nombres compris entre 0 et 255, séparés par des points.  
    
    Exemple :  `172.16.254.1`
    
    Le nombre d'adresses IPv4 possibles est de $256^4 = 4{\space}294{\space}967{\space}296$. Ces adresses sont en cours « d'épuisement », c'est-à-dire qu'il n'y en a plus assez par rapport aux besoins du monde actuel.

-	Une adresse IPv6 est longue de 128 bits et se compose de 8 champs de 16 bits, délimités par deux points (:). Chaque champ doit contenir un nombre hexadécimal, à la différence de la notation en format décimal avec points des adresses IPv4

    Le nombre d'adresses IPv6 disponibles est de $2^{128}$ c'est-à-dire $3,4 {\times} 10^{38}$  adresses, ce protocole semble donc inépuisable. 

!!! abstract "Cours" 
    L'adresse IP est inséparable de son masque de sous-réseau.  Dans le masque, les bits à 1 représentent la partie réseau de l'adresse IP, les bits à 0 représentent la partie machine. 

Comme le masque de sous-réseau est codé sur 32 bits, voici un exemple possible de masque:

|   |   |   |
|:--|:--|:--|
|   |   |`__________Réseau__________ _Machine`|
|IP|`192.168.1.45`|`11000000.10101000.00000001|00101101|` |
|Masque|`255.255.255.0`|`11111111.11111111.11111111.00000000`|
|Réseau|`192.168.1.0`|`11000000.10101000.00000001.00000000`|


Prenons l'exemple d'une machine d'adresse IP `192.168.1.45` avec le masque `255.255.255.0`. Les bits des trois premiers octets du masque sont à `1`, ils donnent la partie « réseau », et les bits suivant à `0` donnent la partie « machine ». 

L'adresse dont tous les bits de la partie machine sont à `0` (`192.168.1.0`) est l'adresse du réseau entier, celle dont tous les bits de la partie machine sont à `1` (`192.168.1.255`) est l'adresse de diffusion broadcast qui permet d'envoyer un message sur tout le réseau (« *broadcast* »). Ces deux adresses sont réservées, elles ne peuvent pas être utilisées par une machine. Il reste donc  $2^8 - 2 = 254$ adresses disponibles pour les machines sur le réseau `192.168.1.0`, allant de `192.168.1.1` à `192.168.1.254`. 

- `192.168.1.0`    réservée pour l'adresse réseau

- `192.168.1.1` 

- ...

- `192.168.1.254`

- `192.168.1.255`  réservée pour l'adresse de diffusion (*broadcast*)


Pour des raisons de calcul binaire (les « `1` » du masque sont contigus), les masques de sous réseau ne peuvent prendre que les valeurs suivantes : `0` ; `128` ; `192` ; `224` ; `240` ; `248` ; `252` ; `254` ; `255`.

Une autre notation souvent utilisée, **notation CIDR**, consiste à noter directement le nombre de bits significatifs en décimal. Ainsi `192.168.25.0/255.255.255.0` peut aussi écrire `192.168.25.0/24`, car le masque réseau est sur 24 bits.
De même `10.0.0.0/255.0.0.0` peut aussi s'écrire `10.0.0.0/8` ou `192.168.1.192/255.255.255.240` peut s'écrire `192.168.1.192/28`.


## Le routage

Pour que deux machines (ordinateurs, imprimantes, etc.) puissent communiquer entre elles, il faut qu'elles soient  sur le même réseau, c'est-à-dire :

- 	physiquement connectées (reliées pas un câble, sur le même bus, reliés au même commutateur/switch,…) ; et
-	logiquement sur le même réseau (avec la  même adresse de réseau).

Mais comment faire pour communiquer entre machines qui sont sur des réseaux différents ?



