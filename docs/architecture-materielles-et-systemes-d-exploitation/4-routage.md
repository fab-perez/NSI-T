# Protocoles de routage

##	Couche Internet et adresses IP

###	Modèles OSI et TCP/IP

Communiquer consiste à transmettre des informations, mais tant que les interlocuteurs ne lui ont pas attribué un sens, il ne s'agit que de données et pas d'information. Les interlocuteurs doivent donc non seulement parler un langage commun mais aussi maîtriser des règles minimales d'émission et de réception des données. C'est le rôle d'un protocole.

!!! abstract "Cours" 
    L'ensemble des règles qui permettent à 2 machines de communiquer ensemble via un réseau s'appelle un **protocole**.

Afin de s'y retrouver au milieu des protocoles réseaux, les modèles OSI et TCP/IP permettent de les classer selon leurs niveaux d'abstractions, dans ce qu'on appelle des couches. 

!!! abstract "Cours" 
    La définition d'une **couche réseau** est assez abstraite, mais on peut dire qu'il s'agit d'un ensemble de protocoles, qui sont au même niveau d'abstraction, qui ont des fonctions similaires.

Le modèle OSI (de l'anglais Open Systems Interconnection) comporte sept couches. Le modèle TCP/IP est plus simple, il ne comporte que quatre couches : Accès au Réseau, Internet, Transport et Application.


![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-light-mode.png#only-light)
![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-dark-mode.png#only-dark)



###	Couche Accès au Réseau : les adresses MAC

![Une carte réseau Ethernet](assets/4-carte-interface-reseau.png){width="20%" align=right}


Une carte d'interface réseau -- appelée aussi carte réseau ou NIC (pour *Network Interface Controller*) -- par exemple une carte Ethernet ou WiFi, possède une adresse unique, appelée **adresse MAC** (*Media Access Control*) qui est donnée par le constructeur de la carte et qui permet de l'identifier de façon unique.

![Adresse MAC d'une machine dans un réseau Filius](assets/4-adresse-mac-machine-filius.png){width="20%" align=left}

L'adresse MAC est constituée de 6 octets écrits sous forme hexadécimale, chacun séparé par " : " (par exemple : `00:13:A9:58:32:EB`). Les 3 premiers octets définissent le constructeur de la carte réseau (ici Sony Corporation), les 3 derniers le numéro de fabrication.




Dans un réseau, un commutateur (ou *switch*) connaît les adresses MAC des machines qui lui sont branchées. 

Les paquets envoyées à l'adresse MAC `FF:FF:FF:FF:FF:FF` (adresse *broadcast*) sont envoyés à toutes les machines connectées au réseau. Le protocole ARP (*Address Resolution Protocol*) permet de lier les adresses MAC aux adresses IP correspondantes.

###	Couche Internet : les adresses IP

!!! abstract "Cours" 
    L'adresse IP permet d'identifier une machine sur un réseau. 
    
    Une machine qui possède plusieurs cartes d'interface réseau a plusieurs adresses IP, chaque adresse étant associée à une carte réseau.

Il existe actuellement deux versions du protocole IP: **IPv4 et IPv6** :

![Adresse IPv4 représentée avec des chiffres décimaux et binaires. Source: wikipedia](assets/4-adresse-ipv4-light-mode.png#only-light){width="25%" align=right}
![Adresse IPv4 représentée avec des chiffres décimaux et binaires. Source: wikipedia](assets/4-adresse-ipv4-dark-mode.png#only-dark){width="25%" align=right}

-   La version **IPv4 utilise des adresses 32 bit**s, généralement représentées en notation décimale par 4 octets (prenant les valeurs entre 0 et 255), séparés par des points.  
    
    Exemple d'adresse IPv4 :  `172.16.254.1`.
    
    Le nombre d'adresses IPv4 possibles est de $256^4 = 4{\space}294{\space}967{\space}296$. Ces adresses sont en cours « d'épuisement », c'est-à-dire qu'il n'y en a plus assez par rapport aux besoins du monde actuel.

![Adresse IPv6 représentée avec des chiffres hexadécimaux et binaires.. Source: wikipedia](assets/4-adresse-ipv6-light-mode.png#only-light){width="25%" align=right}
![Adresse IPv6 représentée avec des chiffres hexadécimaux et binaires.. Source: wikipedia](assets/4-adresse-ipv6-dark-mode.png#only-dark){width="25%" align=right}


-	La version **IPv6 utilise des adresses plus longues de 128 bits**, représentées par 8 champs de 16 bits, délimités par deux points (:). Chaque champ doit contenir un nombre hexadécimal, ou laissé vide quand il est égal à zéro.

    Exemple d'adress IPv6 : `3002:0bd6::::ee00:0033:6778`

    Le nombre d'adresses IPv6 disponibles est de $2^{128}$ c'est-à-dire $3,4 {\times} 10^{38}$  adresses, ce protocole semble donc inépuisable. 

!!! abstract "Cours" 
    L'adresse IP est inséparable de son masque de sous-réseau.  Dans le masque, les bits à 1 représentent la partie réseau de l'adresse IP, les bits à 0 représentent la partie machine. 

Comme le masque de sous-réseau est codé sur 32 bits, voici un exemple possible de masque:

|   |   |   |
|:--|:--|:--|
|   |   |`__________Réseau__________|_Machine`|
|IP|`192.168.1.45`|`11000000.10101000.00000001|00101101` |
|Masque|`255.255.255.0`|`11111111.11111111.11111111|00000000`|
|Réseau|`192.168.1.0`|`11000000.10101000.00000001|00000000`|


Prenons l'exemple d'une machine d'adresse IP `192.168.1.45` avec le masque `255.255.255.0`. Les bits des trois premiers octets du masque sont à `1`, ils donnent la partie « réseau », et les bits suivant à `0` donnent la partie « machine ». 

L'adresse dont tous les bits de la partie machine sont à `0` (`192.168.1.0`) est l'adresse du réseau entier, celle dont tous les bits de la partie machine sont à `1` (`192.168.1.255`) est l'adresse de diffusion broadcast qui permet d'envoyer un message sur tout le réseau (« *broadcast* »). Ces deux adresses sont réservées, elles ne peuvent pas être utilisées par une machine. Il reste donc  $2^8 - 2 = 254$ adresses disponibles pour les machines sur le réseau `192.168.1.0`, allant de `192.168.1.1` à `192.168.1.254`. 

- `192.168.1.0`    réservée pour l'adresse réseau

- `192.168.1.1` 

- ...

- `192.168.1.254`

- `192.168.1.255`  réservée pour l'adresse de diffusion (*broadcast*)


Pour des raisons de calcul binaire (les « `1` » du masque sont contigus), les masques de sous réseau ne peuvent prendre que les valeurs suivantes : `0` ; `128` ; `192` ; `224` ; `240` ; `248` ; `252` ; `254` ; `255`.

Une autre notation souvent utilisée, **notation CIDR**, consiste à noter directement le nombre de bits significatifs en décimal. Ainsi `192.168.25.0/255.255.255.0` peut aussi écrire `192.168.25.0/24`, car le masque réseau est sur 24 bits.
De même `10.0.0.0/255.0.0.0` peut aussi s'écrire `10.0.0.0/8` ou `192.168.1.192/255.255.255.240` peut s'écrire `192.168.1.192/28`.


Il est facile d'identifier les parties réseau et machine d'une adresse IPv4 quand le masque ne comporte que des 255 et des 0, ou un multiple de 8 en notation CIDR, mais ce n'est pas aussi simple pour les autres valeurs de masque -- `128` ; `192` ; `224` ; `240` ; `248` ; `252` ; `254` -- il faut alors "découper" un octet ! Prenons l'exemple de l'adresse `192.168.1.192/255.255.255.240` ou `192.168.1.192/28` en notation CIDR : 

- L'adresse IP `192.168.1.192` s'écrit en binaire `11000000.10101000.00000001.11000000`. 

- Le masque IP `255.255.255.240` s'écrit en binaire `11111111.11111111.11111111.11110000`. 

Dans ce cas, la partie réseau est déterminée par les 28 premiers bits de l'adresse (ceux qui sont à `1`). Elle est obtenue par un `ET` logique entre l'adresse IP et son masque. Tous les bits de l'adresse qui correspondent à un `1` du masque sont gardés, les autres sont remplacés par des `0` : 

|   |   |`___________Réseau_____________|Machine`|
|:--|:--|:--|
|IP|`192.168.1.45 `|`11000000.10101000.00000001.1100|0000` |
|Masque|`255.255.255.240`|`11111111.11111111.11111111.1111|0000`|
|Réseau|`192.168.1.192`|`11000000.10101000.00000001.1100|0000`|

La partie réseau de l'adresse est donc `11000000.10101000.00000001.11000000` autrement dit `192.168.1.192`. 
Les adresses disponibles sur ce réseau sont donc :

- `11000000.10101000.00000001.1100|0000` c'est-à-dire `192.168.1.192`    réservée pour l'adresse réseau

- `11000000.10101000.00000001.1100|0001` c'est-à-dire `192.168.1.193`
- `11000000.10101000.00000001.1100|0010` c'est-à-dire `192.168.1.194`

- ...
- `11000000.10101000.00000001.1100|1110` c'est-à-dire `192.168.1.206`
- `11000000.10101000.00000001.1100|1111` c'est-à-dire `192.168.1.207` réservée pour l'adresse de diffusion (*broadcast*)

Les adresses diponbibles pour les ordinateurs sur ce réseau vont de `192.168.1.193` à `192.168.1.206`, il y en a donc $2^4 - 2 = 14$.

!!! question "Exercice corrigé" 
	On donne l'adress IPv4 d'une machine `192.168.2.60/25`.
    Déterminer l'adresse de ce réseau et les adresses possibles des autres machines sur ce réseau.
        

??? Success "Réponse"
    Ecrivons l'adresse IP en binaire et séparons la partie réseau (les 25 premiers bits) de l apartie machine (les 7 bits suivants) : 

    |   |   |`___________Réseau____________|Machine`|
    |:--|:--|:--|
    |IP|`192.168.2.60 `|`11000000.10101000.00000010.0|0111100` |
    |Masque|25 bits|`11111111.11111111.11111111.1|0000000`|
    |Réseau|`192.168.1.192`|`11000000.10101000.00000010.0|0000000`|
    
    Les adresses disponibles sur ce réseau sont donc :

    - `11000000.10101000.00000010.0|0000000` c'est-à-dire `192.168.2.0` (adresse réseau)
    - `11000000.10101000.00000010.0|0000001` c'est-à-dire `192.168.2.1`
    - `11000000.10101000.00000010.0|0000010` c'est-à-dire `192.168.2.2`
        - ...
    - `11000000.10101000.00000010.0|1111110` c'est-à-dire `192.168.2.126`
    - `11000000.10101000.00000010.0|1111111` c'est-à-dire `192.168.2.127` (adresse de diffusion (*broadcast*)) 

    L'adresse du réseau est `192.168.2.0/25`.

    Il y a $2^7 - 2 = 126$ adresses machine disponibles, allant de `192.168.2.1` à `192.168.2.126`.



## Routage

Pour que deux machines (ordinateurs, imprimantes, etc.) puissent communiquer entre elles, il faut qu'elles soient sur le même réseau, c'est-à-dire :

- 	physiquement connectées (reliées pas un câble, sur le même bus, reliés au même commutateur/switch,…) ; et
-	logiquement sur le même réseau (avec la  même adresse de réseau).

Mais comment faire pour communiquer entre machines qui sont sur des réseaux différents ?

### Routeurs

!!! abstract "Cours" 
    Des machines qui ne sont pas sur un même réseau peuvent communiquer par le biais d'un ou plusieurs routeurs qui relayent (ou « commutent ») les **paquets de données** vers les adresses IP d'un réseau à l'autre[^4.1] . 
    
    Chaque routeur dispose de **plusieurs interfaces de cartes réseaux** permettant de communiquer sur **plusieurs réseaux**[^4.2]. 

[^4.1]: Contrairement aux  commutateurs (ou **swithc**)) qui se basent sur les adresses MAC et  sont limités à un réseau local.

[^4.2]: Une box de Fournisseur d'Accès à Internet (FAI) est un routeurs qui a souvent 3  interfaces : 

    - une interface connectée au réseau de l'opérateur (FAI). 
    - une interface filaire (Ethernet) connectée au réseau local. 
    - une interface Wifi.


Voici un exemple de plusieurs routeurs relayant des paquets de données depuis un poste « Client » vers un « Serveur » dans deux réseaux locaux séparés.

![Un exemple de routage entre deux réseaux locaux à travers 6 routeurs](assets/4-routage-entre-reseaux-locaux-7-routeurs-light-mode.png#only-light){width="100%"}
![Un exemple de routage entre deux réseaux locaux à travers 6 routeurs](assets/4-routage-entre-reseaux-locaux-7-routeurs-dark-mode.png#only-dark){width="100%"}


### Tables de routage

Quand un routeur reçoit un paquet venant du Client et destiné au Serveur, comment sait-il à quel autre routeur faire suivre le paquet ? 

!!! abstract "Cours" 
    Les  **tables de routage**  permettent d'acheminer les paquets de données à travers un réseau vers leur destination finale.

La table de routage d'un routeur, ou de n'importe quelle machine présente sur un réseau[^4.3], décrit où envoyer les paquets de données afin de les rapprocher de destination finale. Elle contient plusieurs lignes avec les informations suivantes :

[^4.3]: Toute machine connectée à un réseau possède une table de routage, une imprimante, un téléphone, etc.

-   **Destination** : l'adresse IP d'un réseau ou le nom d'un routeur auquel se rapportent les informations de routage. 

    Les paquets dont la destination n'est pas connue par le routeur suivent un chemin « par défaut », identfié dans la table par la destinnation **Défaut** ou **`0.0.0.0`**. 

    <figure markdown>
    ![Extrait de la table de routage de R1 avec une destination défaut](assets/4-table-routage-1-light-mode.png#only-light){height="70%"}
    ![Extrait de la table de routage de R1 avec une destination défaut](assets/4-table-routage-1-dark-mode.png#only-dark){height="70%"}
    <figcaption >Extrait de la table de routage de  avec la destination par défaut</figcaption>
    </figure>

    

-	**Passerelle** (ou *gateway*) :  le routeur voisin vers lequel transmettre les paquets pour les rapprocher de leur destination.

    -   Une passerelle appartiennent toujours à l'un des réseaux connectés au routeur.

    -   Il n'y a pas de passerelle quand l'adresse de destination est celle d'un routeur voisin ou d'un réseau directement connecté.

    <figure markdown>
    ![Extrait de la table de routage de R1 avec les passerelles](assets/4-table-routage-2-light-mode.png#only-light){height="70%"}
    ![Extrait de la table de routage de R1 avec les passerelles](assets/4-table-routage-2-dark-mode.png#only-dark){height="70%"}
    <figcaption >Extrait de la table de routage de R1 avec les passerelles</figcaption>
    </figure>


-   **Interface** : la carte d'interface réseau utilisée pour transmettre les paquets de données vers leur destination. 

    Elle est souvent identifiée par un **nom d'interface**, par exemple `eth0`, `eth1`, `wlan0`, etc., pour désigner s'il s'agit de la première ou de la seconde carte Ethernet, de la carte Wi-Fi,etc. 

    <figure markdown>
    ![Extrait de la table de routage de R1 avec les interfaces](assets/4-table-routage-3-light-mode.png#only-light){height="80%"}
    ![Extrait de la table de routage de R1 avec les intefaces](assets/4-table-routage-3-dark-mode.png#only-dark){height="90%"}
    <figcaption >Extrait de la table de routage de R1 avec les noms des interface</figcaption>
    </figure>

    Dans certains cas, c'est l'**adresse IP** du routeur sur le réseau qui sert d'identifiant à l'interface.

      <figure markdown>
    ![Extrait de la table de routage de R1 avec les interfaces](assets/4-table-routage-4-light-mode.png#only-light){height="80%"}
    ![Extrait de la table de routage de R1 avec les intefaces](assets/4-table-routage-4-dark-mode.png#only-dark){height="90%"}
    <figcaption >Extrait de la table de routage de R1 avec les adresses IP des interfaces</figcaption>
    </figure>  

-    **Métrique** :  mesure de la « distance » qui sépare un routeur d'un réseau de destination. Plus la valeur est faible, meilleure est la route. 

    Plusieurs protocoles de routages existent avec différentes règles pour mesurer cette distance, notamment :

    - les protocoles à vecteur de distances, tels que RIP, IGRP.

    - les protocoles à état de liens, tels qu'OSPF et IS-IS, pour le routage au sein d'un système autonome.

    - les protocole à vecteur de chemin: Border Gateway Protocol, pour le routage entre systèmes autonomes.



Voici un exemple de table de routage de R1 (protocole RIP) :


![Table de routage de R1](assets/4-table-routage-light-mode.png#only-light){width="90%"}
![Table de routage de R1](assets/4-table-routage-dark-mode.png#only-dark){width="90%"}



Toutes les machines sur un réseau ont une table de routage.  On peut  observer la table de routage de son ordinateur avec : 

-	`route print` (windows et cygwin) 
-	`ip route` (linux)

### Routage

!!! abstract "Cours" 
    Le **routage** est le mécanisme par lequel des chemins sont sélectionnés dans un réseau pour acheminer les données de routeurs en routeurs jusqu'à leur destination finale.


Observons le trajet d'un paquet allant de l'ordinateur client `192.168.1.15` au serveur `192.168.5.100` dans le réseau précédent.


![Suivi du routage d'un paquet depuis le client jusqu'au serveur](assets/4-routage-suivi-1-light-mode.png#only-light){width="100%"}
![Suivi du routage d'un paquet depuis le client jusqu'au serveur](assets/4-routage-suivi-1-dark-mode.png#only-dark){width="100%"}


Au départ, le paquet est envoyé par l'ordinateur client `198.168.1.15`, sa table de routage ne connait pas l'adresse du serveur `192.168.5.100`, le paquet suit donc le chemin par défaut, il est envoyé par l'interface `198.168.1.15` de l'ordinateur à la passerelle `192.168.1.1`, c'est-à-dire à R1.

![Suivi du routage d'un paquet du client à R1](assets/4-routage-suivi-2-light-mode.png#only-light){width="100%"}
![Suivi du routage d'un paquet du client à R1](assets/4-routage-suivi-2-dark-mode.png#only-dark){width="100%"}

Le paquet arrive sur le routeur R1. L'adresse du serveur n'est toujours pas connue de la table de routage de R1, le paquet suit à nouveau le chemin par défaut, il est envoyé par l'interface `10.1.3.1` de R1 à la passerelle `10.1.3.2`, c'est-à-dire à R3. 

![Suivi du routage d'un paquet de R1 à R3](assets/4-routage-suivi-3-light-mode.png#only-light){width="100%"}
![Suivi du routage d'un paquet de R1 à R3](assets/4-routage-suivi-3-dark-mode.png#only-dark){width="100%"}


Le paquet arrive sur le routeur R3. Cette fois, l'adresse du réseau `192.168.5.0/24` auquel appartient serveur est connue de la table de routage de R3, le paquet suit le chemin indiqué dans la table de routage, il est envoyé par l'interface `10.1.5.1` de R3 à la passerelle `10.1.5.2`, c'est-à-dire à R5. 

![Suivi du routage d'un paquet de R3 à R5](assets/4-routage-suivi-4-light-mode.png#only-light){width="100%"}
![Suivi du routage d'un paquet de R3 à R5](assets/4-routage-suivi-4-dark-mode.png#only-dark){width="100%"}


Le paquet arrive sur le routeur R5, l'adresse du serveur de destination  `192.168.5.100` est directement accessible depuis R5 par son interface `192.168.5.1`, le paquet est envoyé au serveur, ila atteint sa destination finale.


![Suivi du routage d'un paquet de R5 au serveur](assets/4-routage-suivi-5-light-mode.png#only-light){width="100%"}
![Suivi du routage d'un paquet de R5 au serveur](assets/4-routage-suivi-5-dark-mode.png#only-dark){width="100%"}

###	Rôle des protocoles de routage

Le nombre de routeurs dans un réseau est généralement trop grand pour configurer les tables de routage à la main[^4.4] et chaque fois qu'un routeur tombe en panne ou qu'une modification arrive (ajout d'une nouvelle liaison ou d'un nouveau routeur), il faudrait recalculer toutes les chemins et de mettre à jour les tables de routage de chaque routeur.

[^4.4]: Ce type de routage, dit "routage statique", qui consite à configurer les tables de routage manuellement est encore utilisé dans certains cas, par exemple dans de très petits réseaux. 

Alors comment être sûr que les tables de routages seront toujours à jour pour donner le meilleur chemin (le plus court, le plus pertinent, etc...) entre routeurs et pour que le paquet arrive à destination sans se perdre et être détruit[^4.5]  ? 

[^4.5]: Le TTL (*Time To Live*)  indique le nombre de saut qu'il reste à un paquet avant d'être détruit. A chaque fois qu'un router transmet un paquet, il réduit son TTL jusqu'à ce qu'il atteigne zéro et soit détruit

!!! abstract "Cours" 
    Un  **protocole de routage** permet aux **routeurs d'échanger les informations sur le réseau** afin de mettre à jour automatiquement leur **table de routage** pour déterminer les meilleurs chemins possibles.

Un algorithme permet de comparer les différents chemins en utilisant une **métrique**. Plus sa valeur est faible, meilleure est la route. Les protocoles à **vecteurs de distance** (RIP, IGRP, etc.) utilisent la distance en nombre de routeurs, alors que ceux à **états de lien** (OSPF, IS-IS, etc.) utilisent le débit des connexions entre routeurs.

##	RIP : protocole à vecteurs de distance

!!! abstract "Cours" 
    Le **protocole RIP** (*Routing Information Protocol*) est un protocole à **vecteur de distance** qui **minimise la distance** (ou métrique) qui sépare deux machines sur un réseau :

    - La distance est le **nombre de sauts entre routeurs** (*hops*) ou le **nombre de routeurs traversés**[^4.6].

    - La distance est limitée à 15, les distances supérieures sont ignorées.

    - La bande passante (ou débit) de la liaison entre routeurs n'est pas prise en compte.


[^4.6]: "*it is common to use a metric that simply counts how many routers a message must go through*". Source [https://www.rfc-editor.org/rfc/rfc2453.html](https://www.rfc-editor.org/rfc/rfc2453.html).




Par exemple, considérons la table de routage de R1 dans l'exemple précédent. Il faut 2 sauts pour aller de R1 à R4 en passant par R2, mais 3 sauts en passant par R3 et R5. 

La ligne correspondant à la destination R4 dans la table de routage de R1 sera donc le chemin passant par R2, celui passant par R3 et R5 n'est pas utilisé :

![Nombre de sauts minimum de R1 à R4](assets/4-rip-minimise-nombre-sauts-light-mode.png#only-light){width="100%"}
![Nombre de sauts minimum de R1 à R4](assets/4-rip-minimise-nombre-sauts-dark-mode.png#only-dark){width="100%"}

En calculant le nombre de sauts minimum pour atteindre tous les routeurs du réseau depuis R1, on obtient la table de routage de R1 suivante :

![Table de routage de R1 vers les autres routeurs](assets/4-rip-table-routage-r1-nombre-sauts-light-mode.png#only-light){width="100%"}
![Table de routage de R1 vers les autres routeurs](assets/4-rip-table-routage-r1-nombre-sauts-dark-mode.png#only-dark){width="100%"}

Noter que R2 et R3 sont directement connectés à R1, ils n'ont pas de passerelle. 


Jusqu'ici, seuls les routeurs étaient pris en compte dans le calcul des nombres de sauts. Lorsque la table de routage comprends non seulement des routeurs, mais aussi des réseaux, le calcul de la distance est un peu différent. 

Une fois qu'un paquet arrive sur un routeur qui est sur le même réseau que la destination, c'est la technologie de ce réseau (Ethernet ou autre) qui achemine le paquet à sa destination[^4.7], **ce n'est pas compté comme un saut** de routage. Les informations de routage pour toutes les machines d'un réseau sont donc les mêmes, c'est-à-dire ce sont celles du routeur sur lequel ce réseau est connécté[^4.8]. 

[^4.7]:*Once the message gets to a router that is on the same network as the destination, that network's own technology is used to get to the destination.* Source [https://www.rfc-editor.org/rfc/rfc2453.html](https://www.rfc-editor.org/rfc/rfc2453.html).

[^4.8]:*it is best to think of a routing entry for a network as an abbreviation for routing entries for all of the entities connected to that network.  This sort of abbreviation makes sense only because we think of networks as having no internal structure that is visible at the IP level.  Thus, we will generally assign the same distance to every entity in a given network.* Source [https://www.rfc-editor.org/rfc/rfc2453.html](https://www.rfc-editor.org/rfc/rfc2453.html).


Pour simplifier les calculs de distances vers des destinations réseaux (autres que des routeurs), il suffit donc de **compter le nombre de routeurs traversés**. 

![Nombre de routeurs traversés depuis R1 dans l'exemple précédent](assets/4-RIP-routeurs-traverses-depuis-R1-light-mode.png#only-light){width="100%"}
![Nombre de routeurs traversés depuis R1 dans l'exemple précédent](assets/4-RIP-routeurs-traverses-depuis-R1-dark-mode.png#only-dark){width="100%"}

À notre :

- La distance depuis R1 aux réseaux qui lui sont directement connectés, `192.168.1.0/24` et `10.1.3.0/30`, ainsi que toutes les machines sur ces réseaux (sauf R3 même s'il appartient à ce dernier réseau !) est de 0 ! Il n'y a aucun routeur à traverser pour les atteindre. 

- La distance depuis R1 au réseau `192.168.5.0/24` qui est connecté sur une carte d'interface de R5 est la même que celle entre R1 et R5, c'est-à-dire 2. Il y a 2 routeurs à traverser pour atteindre les machines sur ce réseau.


La table de routage de R1 avec les sous-réseaux de destination se présente alors de la façon suivante :

![Table de routage de R1 vers les réseaux](assets/4-rip-table-routage-r1-routeurs-traverses-light-mode.png#only-light){width="40%"}
![Table de routage de R1 vers les réseaux](assets/4-rip-table-routage-r1-routeurs-traverses-dark-mode.png#only-dark){width="40%"}

:warning:Attention à la confusion, la **distance d'un routeur directement connecté à R1 est 1 mais la distance des réseaux (et machines autres que des routeurs) connectés à R1 est 0**[^4.9] !

[^4.9]: La plupart des exercices de baccalauréat utilisent des tables de routage avec des distances entre routeurs mesurées en nombre de sauts (distances égales à 1 ou plus), mais quelques-uns prennent en compte des distances de routeurs à des réseaux directement connectés (égales à 0) : 21-NSIJ2ME3, 22-NSIJ2NC1, 23-NSIJIME1, 24-sujet-0-a.

###	Mise en place des tables de routages

!!! abstract "Cours" 
    Dans le protocole RIP chaque routeur transmet à ses voisins des **couples (adresse, distance), appelés vecteurs de distance**, indiquant :
    
    - les **adresses** de ses propres voisins et celles qu'il a reçues par d'autres routeurs ;
    - la **distance**, exprimée en nombre de sauts, qui le sépare d'un réseau donné.

Chaque routeur reçoit en permanence (toutes les 30 secondes) de ses voisins les informations de routage qu'ils possèdent. Lorsque le routeur reçoit la réponse de son voisin, il met à jour sa table de routage en ne gardant que les chemins les plus avantageux :

1.	Il reçoit une nouveau chemin vers un sous-réseau inconnu : il l'ajoute dans sa table.
2.	Il reçoit une nouveau chemin plus court vers un sous-réseau connu en passant par un autre routeur : il remplace l'ancien chemin de sa table par le nouveau.
3.	Il reçoit un nouveau chemin plus long vers un sous-réseau connu: il l'ignore.
4.	Il reçoit un chemin existant, mais plus long, vers un routeur passant par le même voisin. Cela veut dire qu'un problème est apparu sur son ancien chemin. Il met donc à jour sa table avec ce nouveau chemin.

Remarques :

- Lorsqu'un routeur reçoit une route, il doit augmenter la distance associée de 1 ;
- Dans tous les cas, le **nombre maximal de sauts autorisés est de 15** (la distance indiquée pour les destinations inconnues est vide ou 16) ;
- Si une adresse de réseau n'apparaît pas pendant trois minutes, elle est supprimée ;
- Le chemin qui traverse le moins de routeurs est calculé par l'algorithme de Bellman-Ford.

Pour illustrer le fonctionnement du protocole RIP, voyons comment évoluent les tables de routage des routeurs R1 et R2 en utilisant ce protocole sur l'exemple précédent : 

=== "1.Initialisation"

    Au début du protocole, les tables des routeurs R1 et R2 sont initialisées avec les informations concernant leurs voisins immédiats, à savoir les adresses des sous-réseaux sur lesquels ils sont directement connectés.

    Table de routage de R1

    |Destination|Passerelle|Interface|Métrique|
    |:-|:-:|:-:|:-:|
    |192.168.1.0/24| |wlan0|0|
    |10.1.1.0/30| |eth0|0|
    
    Table de routage de R2

    |Destination|Passerelle|Interface|Métrique|
    |:-|:-:|:-:|:-:|
    |10.1.1.0/30| |eth0|0|
    |10.1.2.0/30| |eth1|0|
    |10.1.3.0/30| |eth3|0|
    |10.1.4.0/30| |eth2|0|
    
    La colonne "passerelle" est vide puisque R1 et R2 peuvent atteindre ces destinations directement. L'interface `eth0` signifie que R1 est directement relié au sous-réseau `10.1.1.0/30` par une carte Ethernet ; le numéro associé au nom de l'interface permet de savoir quelle carte utiliser parmi toutes celles disponibles sur le routeur. De même, `wlan0` indique que R1 est connecté au sous-réseau 192.168.1.0/24 via une interface sans fil.
    
    La distance est de 0 puisqu'il s'agit d'information sur des réseaux directement connectés.


=== "2.Mise à jour de tables"

    Après avoir échangé une demande RIP avec R2, la table du routeur R1 devient :

    |Destination|Passerelle|Interface|Métrique|
    |:-|:-:|:-:|:-:|
    |192.168.1.0/24| |wlan0|0|
    |10.1.1.0/30| |eth0|0|
    |10.1.2.0/30|R2|eth0|1|
    |10.1.3.0/30|R2|eth0|1|
    |10.1.4.0/30|R1|eth0|1|

 	De la même manière, la table du routeur R2 contient les informations suivantes après son échange avec R1.

    |Destination|Passerelle|Interface|Métrique|
    |:-|:-:|:-:|:-:|
    |10.1.1.0/30| |eth0|0|
    |10.1.2.0/30| |eth1|0|
    |10.1.3.0/30| |eth2|0|
    |10.1.4.0/30| |eth3|0|
    |192.168.1.0/24|R1|eth0|1|

En répétant ces demandes RIP (toutes les 30 secondes) et en mettant à jour leurs tables de routages, les routeurs vont finir au bout d'un certain temps par avoir la même "vision" du réseau et des meilleurs chemins à suivre pour acheminer un paquet. 

Par exemple, la table de routage finale pour le routeur R1 est la suivante :

|Destination|Passerelle|Interface|Métrique|
|:-|:-:|:-:|:-:|
|192.168.1.0/24| |wlan0|0|
|10.1.1.0/30| |eth0|0|
|10.1.2.0/30|R2|eth0|1|
|10.1.3.0/30|R2|eth0|1|
|10.1.4.0/30|R1|eth0|1|
|10.1.5.0/30|R1|eth0|2|
|10.1.6.0/30|R1|eth0|2|
|10.1.7.0/30|R1|eth0|2|
|192.168.6.0/24|R1|eth0|3|
|0.0.0.0|R1|eth0|16|

Noter l'adresse de destination par défaut `0.0.0.0` avec une métrique de 16.

Si le protocole RIP est simple et efficace pour les petits réseaux, il montre ses limites pour de plus grands réseaux avec des temps de mise à jour longs (15 x 30 = 450 secondes pour recevoir les informations des routeurs les plus éloignés) et où certaines connexions beaucoup plus rapides que d'autres ne sont pas prises en compte. 

## OSPF: protocole à état de liens
